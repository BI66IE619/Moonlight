<!DOCTYPE html>
<html lang="en-us">
  <head>
    <base href="https://cdn.jsdelivr.net/gh/web-ports/vice-city@796678be4ed26a13c1256be98781ca9b90beb981/" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
    <title>
      GTA Vice City
    </title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="legal-screen">
      <div class="legal-box">
        <h1>
          Legal Notice
        </h1>
        <p>
          This is a
          <strong>          non-commercial, educational fan project
</strong>
          . All assets, characters, and trademarks belong to
          <strong>          Rockstar Games
</strong>
          and
          <strong>          Take-Two Interactive
</strong>
          .
        </p>
        <p>
          If you are a representative of Rockstar Games and wish to discuss this project, please reach out via the contact below:
        </p>
        <div class="contact-info">
          @gnmath on tiktok
        </div>
        <button id="start-button">
          I Understand &amp; Play
        </button>
      </div>
    </div>
    <div id="loading-text" style="color: white; font-size: 48px; font-family: cursive; text-align: center; margin-top: 20px;">
      LOADING...
    </div>
    <div class="wasted-container" hidden="">
    </div>
    <div class="intro-container" hidden="">
      <div class="loader-container">
        <div class="progress-bar-container" id="spinner">
          <div class="progress-bar-fill">
          </div>
        </div>
        <div id="status">
          Downloading...
        </div>
        <div>
          <progress id="progress">
          </progress>
        </div>
      </div>
    </div>
    <input type="file" id="original-game-file" hidden="" />
    <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()">
    </canvas>
    <div class="touch-controls-wrapper">
      <div id="move">
      </div>
      <div id="look">
      </div>
      <div class="touch-control radio">
      </div>
      <div class="touch-control weapon">
      </div>
      <div class="touch-control menu">
      </div>
      <div class="touch-control fist">
      </div>
      <div class="touch-control drift">
      </div>
      <div class="touch-control run">
      </div>
      <div class="touch-control car getIn">
      </div>
      <div class="touch-control left">
      </div>
      <div class="touch-control right">
      </div>
      <div class="touch-control jump">
      </div>
      <div class="touch-control car getOut">
      </div>
      <div class="touch-control camera">
      </div>
      <div class="touch-control mobile">
      </div>
      <div class="touch-control job">
      </div>
      <div class="touch-control horn">
      </div>
      <div class="touch-control fireRight">
      </div>
      <div class="touch-control fireLeft">
      </div>
    </div>
    <script>
    </script>
    <script>
      const loadingText = document.querySelector(&#34;#loading-text&#34;);
let loadedBytes = 0;
const DB_NAME = &#34;gameFilesDB&#34;;
const STORE_NAME = &#34;files&#34;;

// Open or create IndexedDB
function openDB() {
    return new Promise((resolve, reject) =&gt; {
        const request = indexedDB.open(DB_NAME, 1);
        request.onupgradeneeded = e =&gt; {
            const db = e.target.result;
            if (!db.objectStoreNames.contains(STORE_NAME)) {
                db.createObjectStore(STORE_NAME);
            }
        };
        request.onsuccess = e =&gt; resolve(e.target.result);
        request.onerror = e =&gt; reject(e.target.error);
    });
}

// Save file to IndexedDB
async function saveFile(name, buffer) {
    const db = await openDB();
    return new Promise((resolve, reject) =&gt; {
        const tx = db.transaction(STORE_NAME, &#34;readwrite&#34;);
        const store = tx.objectStore(STORE_NAME);
        store.put(buffer, name);
        tx.oncomplete = () =&gt; resolve();
        tx.onerror = e =&gt; reject(e.target.error);
    });
}

// Get file from IndexedDB
async function getFile(name) {
    const db = await openDB();
    return new Promise((resolve, reject) =&gt; {
        const tx = db.transaction(STORE_NAME, &#34;readonly&#34;);
        const store = tx.objectStore(STORE_NAME);
        const request = store.get(name);
        request.onsuccess = e =&gt; resolve(e.target.result);
        request.onerror = e =&gt; reject(e.target.error);
    });
}

// Fetch with progress and caching
async function fetchWithCache(name, url) {
    let cached = await getFile(name);
    if (cached) return cached; // Return cached version

    const response = await fetch(url);
    const reader = response.body.getReader();
    let chunks = [];
    let received = 0;

    while (true) {
        const { done, value } = await reader.read();
        if (done) break;
        received += value.length;
        loadedBytes += value.length;
        chunks.push(value);

        let mbDone = (loadedBytes / (1024 * 1024)).toFixed(2);
        let mbTotal = &#39;633.45&#39;;
        loadingText.textContent = `LOADING... ${mbDone} MB / ${mbTotal} MB`;
    }

    let fullBuffer = new Uint8Array(received);
    let offset = 0;
    for (let chunk of chunks) {
        fullBuffer.set(chunk, offset);
        offset += chunk.length;
    }

    await saveFile(name, fullBuffer.buffer); // Cache it
    return fullBuffer.buffer;
}

// Merge multiple parts
async function mergeFiles(fileParts, namePrefix) {
    const buffers = [];
    for (let i = 0; i &lt; fileParts.length; i++) {
        const buffer = await fetchWithCache(`${namePrefix}.part${i+1}`, fileParts[i]);
        buffers.push(buffer);
    }
    const mergedBlob = new Blob(buffers);
    return URL.createObjectURL(mergedBlob);
}

// Generate part URLs
function getParts(file, start, end) {
    let parts = [];
    for (let i = start; i &lt;= end; i++) {
        parts.push(file + &#34;.part&#34; + i);
    }
    return parts;
}

// Start fetching and caching
Promise.all([
    mergeFiles(getParts(&#34;index.data&#34;, 1, 7), &#34;index.data&#34;),
    mergeFiles(getParts(&#34;audio/emotion.adf&#34;, 1, 3), &#34;emotion.adf&#34;),
    mergeFiles(getParts(&#34;audio/espant.adf&#34;, 1, 3), &#34;espant.adf&#34;),
    mergeFiles(getParts(&#34;audio/fever.adf&#34;, 1, 3), &#34;fever.adf&#34;),
    mergeFiles(getParts(&#34;audio/flash.adf&#34;, 1, 3), &#34;flash.adf&#34;),
    mergeFiles(getParts(&#34;audio/kchat.adf&#34;, 1, 3), &#34;kchat.adf&#34;),
    mergeFiles(getParts(&#34;audio/vcpr.adf&#34;, 1, 2), &#34;vcpr.adf&#34;),
    mergeFiles(getParts(&#34;audio/vrock.adf&#34;, 1, 4), &#34;vrock.adf&#34;),
    mergeFiles(getParts(&#34;audio/wave.adf&#34;, 1, 4), &#34;wave.adf&#34;),
    mergeFiles(getParts(&#34;audio/wild.adf&#34;, 1, 4), &#34;wild.adf&#34;),
]).then(([indexdataurl, EMOTIONadfurl, ESPANTadfurl, FEVERadfurl, FLASHadfurl, KCHATadfurl, VCPRadfurl, VROCKadfurl, WAVEadfurl, WILDadfurl]) =&gt; {
    
    // Override fetch to use cached URLs
    const originalFetch = window.fetch;
    window.fetch = async function(input, init) {
        let urlString = input instanceof Request ? input.url : String(input);

        if (urlString.toLowerCase().includes(&#34;index.data&#34;.toLowerCase())) input = indexdataurl;
        else if (urlString.toLowerCase().includes(&#34;emotion.adf&#34;.toLowerCase())) input = EMOTIONadfurl;
        else if (urlString.toLowerCase().includes(&#34;espant.adf&#34;.toLowerCase())) input = ESPANTadfurl;
        else if (urlString.toLowerCase().includes(&#34;fever.adf&#34;.toLowerCase())) input = FEVERadfurl;
        else if (urlString.toLowerCase().includes(&#34;flash.adf&#34;.toLowerCase())) input = FLASHadfurl;
        else if (urlString.toLowerCase().includes(&#34;kchat.adf&#34;.toLowerCase())) input = KCHATadfurl;
        else if (urlString.toLowerCase().includes(&#34;VCPR.adf&#34;.toLowerCase())) input = VCPRadfurl;
        else if (urlString.toLowerCase().includes(&#34;VROCK.adf&#34;.toLowerCase())) input = VROCKadfurl;
        else if (urlString.toLowerCase().includes(&#34;WAVE.adf&#34;.toLowerCase())) input = WAVEadfurl;
        else if (urlString.toLowerCase().includes(&#34;WILD.adf&#34;.toLowerCase())) input = WILDadfurl;

        return originalFetch(input.toLowerCase(), init);
    };

    // Similarly override XHR
    const originalOpen = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function(method, url, ...rest) {
        if (url.includes(&#34;https://cdn.dos.zone/vcsky/fetched/&#34;.toLowerCase())) url = url.replace(&#34;https://cdn.dos.zone/vcsky/fetched/&#34;, &#34;&#34;)
        if (url.toLowerCase().includes(&#34;index.data&#34;.toLowerCase())) url = indexdataurl;
        else if (url.toLowerCase().includes(&#34;emotion.adf&#34;.toLowerCase())) url = EMOTIONadfurl;
        else if (url.toLowerCase().includes(&#34;espant.adf&#34;.toLowerCase())) url = ESPANTadfurl;
        else if (url.toLowerCase().includes(&#34;fever.adf&#34;.toLowerCase())) url = FEVERadfurl;
        else if (url.toLowerCase().includes(&#34;flash.adf&#34;.toLowerCase())) url = FLASHadfurl;
        else if (url.toLowerCase().includes(&#34;KCHAT.adf&#34;.toLowerCase())) url = KCHATadfurl;
        else if (url.toLowerCase().includes(&#34;VCPR.adf&#34;.toLowerCase())) url = VCPRadfurl;
        else if (url.toLowerCase().includes(&#34;VROCK.adf&#34;.toLowerCase())) url = VROCKadfurl;
        else if (url.toLowerCase().includes(&#34;WAVE.adf&#34;.toLowerCase())) url = WAVEadfurl;
        else if (url.toLowerCase().includes(&#34;WILD.adf&#34;.toLowerCase())) url = WILDadfurl;
        return originalOpen.call(this, method, url.toLowerCase(), ...rest);
    };

    // Load game scripts
    [&#34;gamepademulator.js&#34;, &#34;idbfs.js&#34;, &#34;game.js&#34;].forEach(src =&gt; {
        const script = document.createElement(&#34;script&#34;);
        script.src = src;
        document.body.appendChild(script);
    });

    loadingText.remove();
});
    </script>
  </body>
</html>
